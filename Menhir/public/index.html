<html>
<head>
    <!-- Required meta tags always come first -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="x-ua-compatible" content="ie=edge">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="/moduli_copiati/bootstrap/dist/css/bootstrap.min.css">
    <!-- <link rel="stylesheet" href="node_modules/font-awesome/css/font-awesome.min.css"> -->
    <!-- <link rel="stylesheet" href="node_modules/bootstrap-social/bootstrap-social.css"> -->
    
    <link rel="stylesheet" href="/stylesheets/style.css">

    <!-- jQuery -->
    <!-- <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script> -->
        
    <!-- jQuery first, then Popper.js, then Bootstrap JS. -->
    <script src="moduli_copiati/jquery/dist/jquery.slim.min.js"></script>
    <script src="moduli_copiati/popper.js/dist/umd/popper.min.js"></script>
    <script src="moduli_copiati/bootstrap/dist/js/bootstrap.min.js"></script>  
    
    <!-- Axios -->
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>

    <title> index.html </title>
</head>

    <body onload=autoExec()>
        <div class="container">
            <div class="row row-content">
                <div class="col-md-4">    <!-- lato SX (border border-secondary rounded) -->
                <div id="ElencoJob">   
                    <!-- Test tipi di LINK : style="display:none" -->
                    <div id="bzero" class="row" style="display:none">
                        <button type="button" class="btn btn-link btn-sm" onclick="axiosGetId('0')">Test 0 btn-link btn-sm</button>
                    </div>
                    <div class="row" style="display:none">
                        <a href="#" onclick="axiosGetId('1')">Test 1 solo tag "a"</a>                        
                    </div>                
                    <div class="row" style="display:none">
                        <a href="#" class="badge badge-light" onclick="axiosGetId('2')">Test 2 badge-light</a>
                    </div>
                    <div class="row" style="display:none">
                        <a href="#" class="badge badge-info" onclick="axiosGetId('3')">Test 3 badge-info</a>
                    </div>
                    <div class="row" style="display:none">
                        <a href="#" class="badge badge-dark" onclick="axiosGetId('4')">Test 4 badge-dark</a>
                    </div>
                    <div class="row" style="display:none">
                        <button type="button" class="btn btn-info" onclick="axiosGetId('9')">Test 9 btn-info </button>
                    </div>
                    <!-- Fine tipi di LINK -->
                </div>                    <!-- fine Elenco Job -->                     
                </div>               
                <div class="col-md-8">    <!-- lato DX-->
                    <h4 id=job_des>nome procedura</h4>
                    <form action="">
                        <!-- Campi di Input -->
                        <div class="form-group row">
                            <label for="job_dir" class="col-md-2 col-form-label">Directory</label>
                            <div class="col-md-10">
                                <input type="text" class="form-control" id="job_dir" placeholder="rep_dir">
                            </div>
                        </div>
                        <div class="form-group row">
                            <label for="job_name" class="col-md-2 col-form-label">Job / Trans</label>
                            <div class="col-md-10">
                                <input type="text" class="form-control" id="job_name" placeholder="rep_obj">
                            </div>
                        </div>
                        <!-- Parametri -->
                        <div class="gruppo-parametri form-group row" id="PP0" name="PPall" style="display:none">
                                <label for="P0" class="col-md-2 col-form-label">parametro 0</label>
                                <div class="col-md-10">
                                    <input type="text" class="form-control" id="P0" placeholder="____">
                                </div>
                        </div>
                        <div class="gruppo-parametri form-group row" id="PP1" name="PPall" style="display:none">
                            <label for="P1" class="col-md-2 col-form-label">parametro 1</label>
                            <div class="col-md-10">
                                <input type="text" class="form-control" id="P1" placeholder="____">
                            </div>
                        </div> 
                        <div class="gruppo-parametri form-group row" id="PP2" name="PPall" style="display:none">
                            <label for="P2" class="col-md-2 col-form-label">parametro 2</label>
                            <div class="col-md-10">
                                <input type="text" class="form-control" id="P2" placeholder="____">
                            </div>
                        </div>  

                        <div class="gruppo-parametri form-group row" id="PP3" name="PPall" style="display:none">
                            <label for="P3" class="col-md-2 col-form-label">parametro 3</label>
                            <div class="col-md-10">
                                <input type="text" class="form-control" id="P3" placeholder="____">
                            </div>
                        </div>  
                        <div class="gruppo-parametri form-group row" id="PP4" name="PPall" style="display:none">
                            <label for="P4" class="col-md-2 col-form-label">parametro 4</label>
                            <div class="col-md-10">
                                <input type="text" class="form-control" id="P4" placeholder="____">
                            </div>
                        </div>  
                        <div class="gruppo-parametri form-group row" id="PP5" name="PPall" style="display:none">
                            <label for="P5" class="col-md-2 col-form-label">parametro 5</label>
                            <div class="col-md-10">
                                <input type="text" class="form-control" id="P5" placeholder="____">
                            </div>
                        </div>  
                        <div class="gruppo-parametri form-group row" id="PP6" name="PPall" style="display:none">
                            <label for="P6" class="col-md-2 col-form-label">parametro 6</label>
                            <div class="col-md-10">
                                <input type="text" class="form-control" id="P6" placeholder="____">
                            </div>
                        </div>  
                        <div class="gruppo-parametri form-group row" id="PP7" name="PPall" style="display:none">
                            <label for="P7" class="col-md-2 col-form-label">parametro 7</label>
                            <div class="col-md-10">
                                <input type="text" class="form-control" id="P7" placeholder="____">
                            </div>
                        </div>  
                        <div class="gruppo-parametri form-group row" id="PP8" name="PPall" style="display:none">
                            <label for="P8" class="col-md-2 col-form-label">parametro 8</label>
                            <div class="col-md-10">
                                <input type="text" class="form-control" id="P8" placeholder="____">
                            </div>
                        </div>  
                        <div class="gruppo-parametri form-group row" id="PP9" name="PPall" style="display:none">
                            <label for="P9" class="col-md-2 col-form-label">parametro 9</label>
                            <div class="col-md-10">
                                <input type="text" class="form-control" id="P9" placeholder="____">
                            </div>
                        </div>  

                        <!-- Bottoni -->
                        <div class="form-group row">
                            <div class="offset-md-2 col-md-4">
                                <button class="btn btn-primary" type="button" onclick="buttonRun()">Run</button>
                            </div>
                            <div class="col-md-2">
                                <button class="btn btn-dark btn-sm" type="button" onclick="test()">Test</button>
                            </div>
                            <div class="col-md-2">
                                    <button class="btn btn-basic btn-sm" type="button" onclick="axiosGet()">axiosGet()</button>
                            </div>
                            <div class="col-md-2">
                                <button class="btn btn-warning btn-sm" type="button" onclick="toggleEle()">Togg</button>
                            </div>
                        </div>
                    </form>                    
                    <div class="form-group">
                        <label for="err">Err</label>
                        <textarea id="err" style = "font-family:arial; color:rgb(255, 0, 0);" class="form-control" rows="1"> </textarea>
                        <label for="log">Log</label>
                        <textarea id="log" style = "font-family:arial; color:rgb(0, 0, 255);" class="form-control" rows="10"> </textarea>
                    </div>
                </div>

            </div>
        </div>
    </body>
    
    <script>
     var currentJob = {};

     function autoExec() {
         axiosGet();
     }

    // TEST _________________________________________________________________________________________________________
    function test() {
        var ele = $("#ElencoJob");    
        var b0 = $("#bzero");   
        console.log(ele.attr('id'));
        console.log(ele.html());
        console.log(b0.attr('id'));
        console.log(b0.html());

                
        const button = '<button type="button" class="btn btn-info" onclick="axiosGetId(\'xIDx\')" >xNOMEx</button> '
        const div = '<div class="row">' + button + '</div>';
        var new_div = div.replace("xIDx", "10");
        new_div = new_div.replace("xNOMEx", "Procedura 10");
        ele.append(new_div);
        console.log(ele.attr('id'));
        console.log(ele.html());
    }
    
    function toggleEle() {
        $(".gruppo-parametri").toggle();
    }
    
    // ________________________________________________________________________________________________________________

    // Get
    function axiosGet() {
        const Url='http://menhir:3000/dishes';
        console.log("log funzione axiosGet:" + Url)
        // make request to our API
        axios.get(Url)
        .then(function(response) {
            // console.log(response.data);
            // $("#log").val(response.data);
            listJobs(response.data);
        })
        .catch(function(error) {
            console.log(error);
        })
        
    }
    function listJobs(jobArray){
        var ele = $("#ElencoJob"); 
        var new_div;   
        const link = '<a href="#" onclick="axiosGetId(\'xIDx\')">xNOMEx</a>';
        const div = '<div class="row">' + link + '</div>';

        for (var j in jobArray){
            // console.log(j);
            console.log(jobArray[j].id);
            console.log(jobArray[j].name);
            new_div = div.replace("xIDx", jobArray[j].id);
            new_div = new_div.replace("xNOMEx", jobArray[j].name);
            ele.append(new_div);
        }
    }
    // Get Id
    function axiosGetId(id) {
        const base='http://menhir:3000/dishes/';
        let Url=base+id;
        
        console.log("log funzione axiosGetId:" + Url);
        $("#log").val(null);
        $("#err").val(null); 

        // make request to our API
        axios.get(Url)
        .then(function(response) {
            console.log('axios.get.then');
            console.log('Status: ' + response.statusText + ' ('+response.statusText+')');
            console.log(response.data); 
            $(".gruppo-parametri").hide();
            currentJob = response.data;         
            $("#job_des").text(currentJob.name);
            $("#job_dir").val(currentJob.rep_dir);
            $("#job_name").val(currentJob.rep_obj);
            formParametri(currentJob);
            // oggetto job nel Log
            $("#log").val(JSON.stringify(currentJob).replace(/,/g,",\n").replace(/{/g,"{\n").replace(/}/g,"\n}"));
        })
        .catch(function(error) {
            console.log('axios.get.catch');
            console.log(error.message);
            $("#log").val(error.message);            
        })
        
    }
    // Visualizza i campi variabili del form per l'inserimento dei parametri
    function formParametri(job) {
        var j=0;
        var ele, label; 
        if (job.pdi_par) {
            for (var k in job.pdi_par) {
                ele = $("#P"+j);
                grp = $("#PP"+j);
                label =  $("label[for='P" + j + "']")
                ele.val(job.pdi_par[k]);
                label.text(k);
                j++;
                grp.show();
            };
        }
    }
    // bottone RUN
    function buttonRun() {
        console.log('buttonRun()');
        $("#log").val(null); 
        $("#err").val(null); 

        let cj = currentJob;
        setParametri(cj);
        axiosPost(cj);        
    }
    //Post
    function axiosPost(job) {
        const Url='http://menhir:3000/dishes';

        axios.post(Url,job)
        .then(function(response) {
            // console.log(response.data);
            console.log("axiosPost: response.data = \n" + JSON.stringify(response.data));
            $("#log").val(response.data.log);
            $("#err").val(response.data.err);
        })
        .catch(function(error) {
            console.log(error);
        })
    }
    
    // copia i valori dei parametri
    // dal Form a currentJob
    function setParametri(job) {
        var j=0;
        var ele, label; 

        job.rep_dir = $("#job_dir").val();
        job.rep_obj = $("#job_name").val();
        // console.log('$("#job_dir").val()' + $("#job_dir").val());

        if (job.pdi_par) {
            for (var k in job.pdi_par) {
                ele = $("#P"+j);
                console.log(' setParametri(job): ' + k + '=' + ele.val()); 
                job.pdi_par[k] = ele.val();
                j++;                
            };
        }
    }

    </script>
</html>